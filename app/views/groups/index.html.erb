<div class="container text-center">
  <div class="row">
    <div class="col-sm">
      <h1>Group List</h1>
    </div>
    <div class="input-group col-sm">
<!--      <input type="text" class="form-control" placeholder="Search...">-->
<!--      <div class="input-group-append">-->
<!--        <button class="btn btn-primary mb-5" type="submit">Search</button>-->
<!--      </div>-->
    </div>
    <div class="col-sm text-right">
      <% if params[:user].present? %>
        <%= link_to "All Groups", groups_path, class: 'btn btn-primary' %>
      <% else %>
        <%= link_to "My Groups", groups_path(user: current_user), class: 'btn btn-primary' %>
      <% end %>
      <%= link_to new_group_path, class: 'btn btn-primary' do %>
        Add New Group
      <% end %>
    </div>
  </div>

  <div class="table-responsive mb-10">
    <table class="table table-striped table-bordered table-hover">
      <thead>
      <tr>
        <th>Group Name</th>
        <th>Admin</th>
        <th></th>
        <th></th>
      </tr>
      </thead>

      <tbody>
      <% @groups.each do |group| %>
        <%= content_tag :tr, id: dom_id(group), class: dom_class(group) do %>

          <td><%= link_to group.name, group %></td>
          <td> <%= link_to group.user.name, wall_path(uuid: group.user.uuid) %> </td>
          <td>
            <% unless group.user == current_user || group.members.include?(current_user) || group.requests.exists?(user_id: current_user.id) %>
              <%= link_to "Request to Join", request_to_join_group_path(group), method: :post, class: "btn btn-primary" %>
            <% end %>
            <% if current_user && group.memberships.exists?(user_id: current_user.id) %>
              <%= link_to 'Leave Group', leave_group_group_path(group), method: :delete, data: {confirm: 'Are you sure?'} %>
            <% end %>
          </td>
          <td>
            <% unless group.user == current_user %>
              <% if group.flags.pluck(:user_id).include?(current_user.id) %>
                <% group_flag = group.flags.where(user_id: current_user.id).first %>
                <%= link_to flag_path(id: group_flag.id, flagable_id: group.id, flagable_type: 'Group'), method: :delete, class: 'btn btn-primary', title: 'Un-Flag this group', remote: true do %>
                  <i class="fa fa-flag" aria-hidden="true"></i>
                <% end %>
              <% else %>
                <!-- Button trigger flag modal -->
                <button type="button" class="btn btn-outline-secondary" data-toggle="modal" data-target="#flag<%= group.id %>">
                  <i class="fa fa-flag-checkered" aria-hidden="true"></i>
                </button>
              <% end %>
            <% end %>
          </td>
        <% end %>
        <!-- flage Modal -->
        <div class="modal fade" id="flag<%= group.id %>" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Report this version</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <%= form_with(model: group.flags.build, local: true, remote: true) do |form| %>
                <div class="modal-body">
                  <%= form.hidden_field :user_id, value: current_user.id %>
                  <%= form.hidden_field :flagable_id, value: group.id %>
                  <%= form.hidden_field :flagable_type, value: "Group" %>

                  <div class="form-group">
                    <%= rich_text_area_tag :version_reason, nil, autofocus: true, class: 'form-control', placeholder: "Reason" %>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <%= form.submit 'Create', class: 'btn btn-primary' %>
                </div>
              <% end %>
            </div>
          </div>
        </div>

      <% end %>
      </tbody>
    </table>
  </div>
</div>



